# Worklog - December 8, 2025

## Summary
Added "No Expiration" checkbox for courses, upgraded Next.js/React for CVE security fix, and rebuilt Course Cleanup page for reviewing duplicate T-Code courses.

---

## 1. Course Cleanup Page Rebuild (`/course-groups`)

Completely redesigned the page from "Custom Chains" to "Course Cleanup" - a simpler approach focused on reviewing duplicate courses.

### The Problem
The original "chains" approach was overcomplicating things. These aren't really chains that need to be linked - they're just courses that share the same T-Code (like T171 PARENT, T171 IL, T171 OL). The real questions are:
- Does each course need to exist?
- Is it one-time training or recurring?
- Should duplicates be merged?

### New Approach
Only shows T-Codes with **multiple courses** (33 groups, 76 courses total). For each course, manager can specify:
- **Action:** Keep, Merge, or Delete
- **One-time:** Checkbox for training taken once (like IL/initial learning)
- **Recert months:** How often to recertify (like 24 months for OL)
- **Notes:** Free-form notes

### Auto-Detected Issues
- PARENT has fewer people than IL/OL (data mismatch)
- No PARENT course but has other variants
- IL/OL combo that should be split
- Courses with 0 employees

### Database Changes
Dropped old tables:
- `custom_group_exclusions`
- `custom_group_notes`

Created new table `course_cleanup`:
| Column | Type | Description |
|--------|------|-------------|
| course_id | VARCHAR | Unique course ID |
| t_code | VARCHAR | T-Code (T171, T719, etc.) |
| original_name | VARCHAR | Course name from CSV |
| action | VARCHAR | pending, keep, merge, delete |
| merge_into | VARCHAR | Course ID to merge into |
| rename_to | VARCHAR | New name if renaming |
| is_one_time | BOOLEAN | One-time training? |
| recert_months | INTEGER | Months until recert |
| notes | TEXT | Free-form notes |
| reviewed_at | TIMESTAMP | When reviewed |

### API Changes
- `GET /api/course-groups` - Returns only T-Codes with multiple courses, includes employee counts
- `POST /api/course-groups` - Save decisions per course
- Removed `/api/course-groups/exclusions` and `/api/course-groups/notes`

### Stats
- **33 T-Code groups** to review
- **76 courses** total in those groups
- 1 group with 4 courses, 8 groups with 3, 24 groups with 2

### Sidebar
- Renamed "Custom Chains" → "Course Cleanup"

---

## 2. Course "No Expiration" Checkbox

### New Course Page (`/new-course`)
- Added "No Expiration (one-time training)" checkbox
- When checked, hides the duration field
- Sets `duration_months` to `null` in database
- Updated confirmation dialog to show "No Expiration"

### Courses Page (`/courses`)
- Added same checkbox to edit panel
- Auto-detects existing no-expiration courses (checkbox pre-checked when `duration_months` is null)
- Updated course list to show "No exp" instead of "0mo"

**Commit:** `8172ceb` - "Add no-expiration checkbox for courses"

---

## 3. Security Update - CVE-2025-55182

Critical RCE vulnerability in React Server Components affecting Next.js 15.x.

### Upgraded:
- **Next.js:** 15.5.4 → 15.5.7 (patched)
- **React:** 19.1.0 → 19.1.2 (patched)
- **React-DOM:** 19.1.0 → 19.1.2 (patched)

Build tested successfully after upgrade.

---

## Next Steps
- Manager reviews 33 T-Code groups in Course Cleanup page
- Marks each course as Keep/Merge/Delete
- Specifies one-time vs recurring for each
- After review complete, use decisions to update courses table

---

## Files Changed
- `app/new-course/page.tsx` - no expiration checkbox
- `app/courses/page.tsx` - no expiration checkbox in edit
- `app/course-groups/page.tsx` - rebuilt as Course Cleanup page
- `app/api/course-groups/route.ts` - updated API with employee counts and POST for decisions
- `components/Sidebar.tsx` - renamed "Custom Chains" → "Course Cleanup"
- `scripts/create-course-cleanup-table.ts` - NEW: database migration script
- `package.json` / `package-lock.json` - Next.js/React upgrade

### Removed Files
- `app/api/course-groups/exclusions/route.ts` - no longer needed
- `app/api/course-groups/notes/route.ts` - no longer needed
